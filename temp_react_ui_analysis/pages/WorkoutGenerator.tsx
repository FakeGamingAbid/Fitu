
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { ArrowLeft, Sparkles, Clock, Activity, Zap, Dumbbell, CheckCircle2, Loader2, Play, Flame } from 'lucide-react';
import { useStore } from '../store';
import { GlassCard, PrimaryButton } from '../components/UI';
import { generateWorkoutPlan } from '../services/geminiService';
import { GeneratedWorkoutPlan } from '../types';

type MuscleGroup = 
  | 'Abs' 
  | 'Back' 
  | 'Biceps' 
  | 'Calves' 
  | 'Chest' 
  | 'Forearms' 
  | 'Glutes' 
  | 'Hamstrings' 
  | 'Obliques' 
  | 'Quads' 
  | 'Shoulders' 
  | 'Traps' 
  | 'Triceps';

const MUSCLE_DATA: Record<MuscleGroup, string[]> = {
  Abs: [
    "M 100.75,123.75 C 100.75,123.75 97.50,126.50 97.50,126.50 97.50,126.50 94.50,140.25 94.50,140.25 94.50,140.25 93.00,152.50 93.00,152.50 93.00,152.50 93.00,162.25 93.00,162.25 93.00,162.25 92.75,172.25 93.00,172.25 93.25,172.25 97.00,177.00 97.00,177.00 97.00,177.00 95.50,180.75 95.50,180.75 95.50,180.75 96.50,193.75 96.50,193.75 96.50,193.75 99.00,202.00 99.00,202.00 99.00,202.00 103.50,215.75 103.50,215.75 103.50,215.75 107.25,220.75 107.25,220.75 107.25,220.75 111.75,224.50 111.75,224.50 111.75,224.50 119.25,224.75 119.25,224.75 119.25,224.75 125.25,217.00 125.25,217.00 125.25,217.00 131.25,201.75 131.25,201.75 131.25,201.75 134.75,190.50 134.75,190.50 134.75,190.50 134.75,179.50 134.75,179.50 134.75,179.50 132.25,178.25 132.25,178.25 132.25,178.25 135.25,173.00 135.25,173.00 135.25,173.00 137.00,166.75 137.00,166.75 137.00,166.75 136.75,156.50 136.75,156.50 136.75,156.50 135.75,144.50 135.75,144.50 135.75,144.50 133.75,133.25 133.75,133.25 133.75,133.25 130.00,124.75 130.00,124.75 130.00,124.75 122.50,122.00 122.50,122.00 122.50,122.00 119.50,122.00 119.50,122.00 119.50,122.00 114.50,126.75 114.50,126.75 114.50,126.75 109.50,120.75 109.50,120.75 109.50,120.75 101.00,124.00 101.00,124.00",
  ],
  Back: [
    "M 392.64,149.10 C 392.27,149.18 392.12,149.19 391.99,149.25 389.72,150.24 387.35,150.69 384.89,150.56 382.22,150.41 379.57,149.93 377.87,147.62 376.09,145.22 374.53,142.65 372.91,140.13 372.62,139.66 372.48,139.10 372.27,138.58 372.18,138.60 372.08,138.62 371.99,138.64 371.98,138.82 371.93,139.01 371.96,139.19 372.90,144.96 373.51,150.78 375.45,156.38 376.89,160.53 378.59,164.50 381.25,168.00 382.04,169.04 382.99,169.97 383.98,170.82 385.11,171.81 385.47,171.64 385.74,170.20 385.76,170.09 385.77,169.97 385.79,169.86 386.85,164.12 388.32,158.50 390.74,153.17 391.33,151.86 391.95,150.56 392.64,149.10",
  ],
  Biceps: [
    "M 49.25,117.25 C 49.25,117.25 45.50,120.75 45.50,120.75 45.50,120.75 42.00,129.00 42.00,129.00 42.00,129.00 41.25,137.75 41.25,137.75 41.25,137.75 42.00,145.25 42.00,145.25 42.00,145.25 46.50,149.50 46.50,149.50 46.50,149.50 48.25,153.25 48.25,153.25 48.25,153.25 49.25,166.50 49.25,166.50 49.25,166.50 60.25,153.00 60.25,153.00 60.25,153.00 61.25,149.50 61.25,149.50 61.25,149.50 63.75,151.50 63.75,151.50 63.75,151.50 68.00,148.75 68.00,148.75 68.00,148.75 73.00,140.50 73.00,140.50 73.00,140.50 74.25,129.50 74.25,129.50 74.25,129.50 74.50,120.25 74.50,120.25 74.50,120.25 74.50,116.50 74.50,116.50 74.50,116.50 73.00,113.00 73.00,113.00 73.00,113.00 71.25,111.50 71.25,111.50 71.25,111.50 68.00,110.50 68.00,110.50 68.00,110.50 57.75,114.25 57.75,114.25 57.75,114.25 49.50,117.50 49.50,117.50",
    "M 166.82,151.36 C 166.99,151.37 166.72,150.23 166.86,150.14 166.46,148.57 166.10,146.98 165.67,145.42 164.18,140.02 162.71,134.62 161.15,129.24 160.79,128.01 158.77,117.31 158.25,114.97 158.05,114.59 157.47,118.80 157.14,121.79 157.09,122.29 157.16,124.59 157.08,125.04 156.95,125.74 157.27,130.26 157.40,130.96 158.57,137.01 159.49,139.00 162.34,144.99 162.91,146.19 164.64,148.86 165.33,149.99 165.62,150.47 166.25,151.31 166.82,151.36"
  ],
  Calves: [
    "M 432.29,380.53 C 433.40,381.41 434.63,381.43 435.95,380.70 439.00,379.01 440.64,376.49 441.69,373.67 443.04,370.01 443.56,366.26 443.57,362.48 443.57,358.91 443.33,355.35 443.19,351.78 442.63,345.13 441.79,338.51 440.02,332.04 439.37,329.64 438.21,327.33 436.04,325.58 435.22,324.92 434.11,324.49 433.07,324.05 432.14,323.66 431.50,324.04 431.47,324.89 431.41,326.32 431.40,327.76 431.48,329.19 431.60,331.20 431.67,334.59 431.68,336.61 431.71,344.21 430.33,346.48 428.25,353.24 426.65,358.46 426.07,363.45 426.64,368.76 426.90,371.21 427.71,373.95 429.59,377.24 429.96,377.89 431.65,380.01 432.29,380.53",
    "M 378.79,319.96 C 378.38,319.97 377.85,320.51 377.62,320.95 376.44,323.18 374.52,325.61 373.42,327.88 370.78,333.40 369.25,335.88 367.29,342.73 366.18,346.60 364.81,350.27 364.42,353.86 364.18,356.09 364.24,360.68 364.39,362.45 364.76,366.72 367.79,368.98 371.84,370.05 374.92,370.87 377.02,369.61 377.26,366.58 377.55,363.00 377.46,359.38 377.80,355.80 378.36,349.86 379.04,343.93 379.85,338.03 380.43,333.81 381.25,329.63 381.25,325.35 381.25,323.72 380.80,322.28 380.00,320.91 379.75,320.49 379.19,319.95 378.79,319.96",
  ],
  Chest: [
    "M 72.50,111.50 C 72.50,111.50 77.50,102.50 77.50,102.25 77.50,102.00 81.75,94.00 81.75,94.00 81.75,94.00 84.50,87.50 84.50,87.50 84.50,87.50 85.50,85.50 85.50,85.50 85.50,85.50 88.75,83.25 88.75,83.25 88.75,83.25 95.50,83.50 95.50,83.50 95.50,83.50 99.75,84.25 99.75,84.25 99.75,84.25 104.25,86.00 104.25,86.00 104.25,86.00 113.00,86.75 113.00,86.75 113.00,86.75 120.50,86.75 120.50,86.75 120.50,86.75 126.75,86.00 126.75,86.00 126.75,86.00 133.50,83.75 133.50,83.75 133.50,83.75 138.00,83.50 138.00,83.50 138.00,83.50 141.50,83.75 141.50,83.75 141.50,83.75 143.75,86.25 143.75,86.25 143.75,86.25 149.00,96.00 149.00,96.00 149.00,96.00 154.25,106.00 154.25,106.00 154.25,106.00 156.00,110.50 156.00,110.50 156.00,110.50 155.00,115.00 155.00,115.00 155.00,115.00 149.75,118.00 149.75,118.00",
    "M 136.75,123.50 C 136.75,123.50 132.50,124.25 132.50,124.25 132.50,124.25 127.75,123.75 127.75,123.75 127.75,123.75 119.75,120.25 119.75,120.25 119.75,120.25 115.00,127.75 115.00,127.75 115.00,127.75 109.25,120.50 109.25,120.50 109.25,120.50 103.00,124.00 103.00,124.00 103.00,124.00 98.50,124.75 98.50,124.75 98.50,124.75 91.75,123.25 91.75,123.25 91.75,123.25 80.00,118.00 80.00,118.00 80.00,118.00 73.00,111.75 73.00,111.75",
  ],
  Forearms: [
    "M 355.58,156.70 C 355.59,156.41 355.36,155.93 355.14,155.87 354.89,155.80 354.44,156.04 354.24,156.27 353.09,157.56 351.97,158.87 350.89,160.21 349.34,162.13 347.83,164.08 346.29,166.01 343.77,169.18 342.67,172.95 341.43,176.65 338.78,184.50 336.21,192.37 333.61,200.23 333.56,200.37 333.47,200.49 333.41,200.62 333.41,200.62 333.22,200.56 333.22,200.56 333.93,198.29 334.63,196.01 335.37,193.75 337.89,185.98 340.45,178.23 342.93,170.45 343.64,168.21 345.02,166.40 346.37,164.53 347.10,163.53 347.70,162.43 348.24,161.32 348.74,160.29 348.53,159.30 347.48,158.68 346.54,158.12 345.55,157.52 344.49,157.26 343.88,157.12 343.42,157.14 343.10,157.31 343.10,157.31 343.10,157.31 343.10,157.31 343.10,157.31 343.08,157.33 343.08,157.33 342.97,157.39 342.88,157.48 342.81,157.58 342.81,157.58 340.41,159.83 340.41,159.83 339.15,160.69 337.92,161.59 336.53,162.57 336.53,162.57 333.38,166.06 333.38,166.06 332.94,166.53 332.53,167.03 332.12,167.52 327.93,172.51 326.70,178.25 326.95,184.54 327.20,190.89 326.96,197.24 325.80,203.51 325.66,203.51 325.52,203.50 325.38,203.50 325.49,199.61 325.66,195.72 325.69,191.83 325.71,189.79 325.50,187.74 325.37,185.71 325.35,185.36 325.33,184.98 325.16,184.69 324.95,184.33 324.59,184.05 324.29,183.73 324.05,184.06 323.71,184.35 323.60,184.71 322.71,187.71 322.00,190.76 320.98,193.70 318.82,199.88 316.52,206.00 314.26,212.14 313.85,213.26 314.07,213.77 315.21,213.55 319.80,212.64 323.64,214.58 327.53,216.36 328.39,216.75 328.98,216.80 329.48,215.84 333.40,208.28 337.44,200.78 341.28,193.19 344.89,186.07 347.98,178.75 350.48,171.20 350.94,169.78 351.85,168.51 352.52,167.15 353.47,165.20 354.59,163.29 355.25,161.25 355.71,159.84 355.54,158.22 355.58,156.70",
  ],
  Glutes: [
    "M 394.25,186.00 C 394.25,186.00 387.50,187.25 387.50,187.25 387.50,187.25 376.00,194.00 376.00,194.00 376.00,194.00 370.00,202.75 370.00,202.75 370.00,202.75 366.25,207.25 366.25,207.25 366.25,207.25 372.75,211.25 372.75,211.25 372.75,211.25 377.00,217.25 377.00,217.25 377.00,217.25 378.75,228.25 378.75,228.25 378.75,228.25 377.25,238.75 377.25,238.75 377.25,238.75 377.00,241.25 377.00,241.25 377.00,241.25 384.50,240.00 384.50,240.00 384.50,240.00 396.25,235.75 396.25,235.75 396.25,235.75 405.75,229.50 405.75,229.50 405.75,229.50 411.25,225.50 411.25,225.50 411.25,225.50 418.75,231.50 418.75,231.50 418.75,231.50 429.75,236.25 429.75,236.25 429.75,236.25 441.50,240.00 441.50,240.00 441.50,240.00 445.75,240.00 445.75,240.00 445.75,240.00 445.00,231.75 445.00,231.75 445.00,231.75 444.50,223.50 444.50,223.50 444.50,223.50 446.00,215.25 446.00,215.25 446.00,215.25 451.50,209.75 451.50,209.75 451.50,209.75 455.75,208.00 455.75,208.00 455.75,208.00 452.00,200.75 452.00,200.75 452.00,200.75 448.00,196.75 448.00,196.75 448.00,196.75 441.00,190.00 441.00,190.00 441.00,190.00 436.75,187.75 436.75,187.75 436.75,187.75 429.25,186.00 429.25,186.00 429.25,186.00 426.00,185.75 426.00,185.75 426.00,185.75 423.50,194.75 423.50,194.75 423.50,194.75 418.75,205.25 418.75,205.25 418.75,205.25 413.75,211.25 413.75,211.25 413.75,211.25 411.00,213.75 411.00,213.75 411.00,213.75 408.25,210.75 408.25,210.75 408.25,210.75 402.50,201.50 402.50,201.50 402.50,201.50 399.50,192.50 399.50,192.50 399.50,192.50 397.25,186.25 397.25,186.25 397.25,186.25 394.50,185.75 394.50,185.75",
  ],
  Hamstrings: [
    "M 365.50,209.50 C 365.50,209.50 370.00,210.00 370.00,210.00 370.00,210.00 375.00,213.50 375.00,213.50 375.00,213.50 377.50,219.25 377.50,219.25 377.50,219.25 377.50,229.25 377.50,229.25 377.50,229.25 377.00,237.25 377.00,237.25 377.00,237.25 377.00,239.75 377.00,239.75 377.00,239.75 382.00,239.75 382.00,239.75 382.00,239.75 389.25,238.75 389.25,238.75 389.25,238.75 400.50,233.25 400.50,233.25 400.50,233.25 406.50,230.25 406.50,230.25 406.50,230.25 408.50,229.25 408.50,229.25 408.50,229.25 408.75,243.50 408.75,243.50 408.75,243.50 410.00,258.00 410.00,258.00 410.00,258.00 409.75,272.25 409.75,272.25 409.75,272.25 409.75,286.50 409.75,286.50 409.75,286.50 408.00,300.50 408.00,300.50 408.00,300.50 403.50,318.50 403.50,318.75 403.50,319.00 399.00,334.75 399.00,334.75 399.00,334.75 393.25,341.25 393.25,341.25 393.25,341.25 392.25,331.25 392.25,331.25 392.25,331.25 392.25,326.00 392.25,326.00 392.25,326.00 391.00,322.25 391.00,322.25 391.00,322.25 384.00,327.25 384.00,327.25 384.00,327.25 382.00,324.50 382.00,324.50 382.00,324.50 379.25,318.75 379.25,318.75 379.25,318.75 376.50,321.25 376.50,321.25 376.50,321.25 371.00,329.50 371.00,329.50 371.00,329.50 369.25,324.00 369.25,324.00 369.25,324.00 368.00,306.25 368.00,306.25 368.00,306.25 366.75,295.00 366.75,295.00 366.75,295.00 363.00,268.50 363.00,268.50 363.00,268.50 362.00,246.25 362.00,246.25 362.00,246.25 362.25,216.50 362.25,216.50 362.25,216.50 364.25,211.75 365.00,209.25",
    "M 441.45,241.64 C 440.46,241.28 439.45,240.94 438.44,240.64 436.85,240.18 436.23,240.55 436.10,242.07 435.85,244.93 435.62,247.81 435.72,250.66 435.90,255.66 436.30,260.65 436.66,265.64 436.81,267.61 437.17,269.56 437.26,271.53 437.59,278.00 437.84,284.47 438.11,290.93 438.45,299.17 440.40,307.00 444.28,314.45 446.28,318.27 447.81,322.30 449.56,326.23 449.65,326.44 449.77,326.63 449.88,326.83 450.01,326.85 450.14,326.86 450.28,326.88 450.60,325.93 451.09,325.00 451.21,324.03 451.51,321.76 451.84,319.46 451.78,317.19 451.66,312.62 451.12,308.06 451.05,303.49 451.05,303.27 451.05,303.05 451.05,302.83 451.05,302.83 453.07,291.65 453.07,291.65 453.26,290.74 453.49,289.83 453.62,288.91 454.93,279.90 456.51,270.91 457.44,261.87 458.22,254.46 458.36,247.00 458.53,239.56 458.64,234.72 458.43,229.86 458.12,225.03 457.86,221.14 457.32,217.25 456.72,213.38 456.38,211.20 454.98,210.62 452.62,211.34 450.64,211.95 449.28,213.23 448.21,214.79 445.94,218.14 445.41,221.86 445.29,225.66 445.12,230.79 446.16,235.77 447.42,240.71 447.37,243.31 443.19,242.21 441.45,241.64",
    "M 414.25,228.25 C 414.25,228.25 421.50,232.00 421.50,232.00 421.50,232.00 437.75,239.75 437.75,239.75 437.75,239.75 445.50,240.50 445.50,240.50 445.50,240.50 445.00,227.00 445.00,227.00 445.00,227.00 446.00,217.00 446.00,217.00 446.00,217.00 450.25,210.75 450.25,210.75 450.25,210.75 455.25,210.50 455.25,210.50 455.25,210.50 457.25,208.75 457.25,208.75 457.25,208.75 459.75,211.50 459.75,211.50 459.75,211.50 461.00,228.00 461.00,228.00 461.00,228.00 461.00,243.75 461.00,243.75 461.00,243.75 460.50,261.25 460.50,261.25 460.50,261.25 456.75,282.75 456.75,282.75 456.75,282.75 453.75,302.50 453.75,302.50 453.75,302.50 453.75,321.50 453.75,321.50 453.75,321.50 452.00,329.25 452.00,329.25 452.00,329.25 447.00,322.25 447.00,322.25 447.00,322.25 444.50,318.00 444.50,318.00 444.50,318.00 441.75,322.00 441.75,322.00 441.75,322.00 439.75,327.75 439.75,327.75 439.75,327.75 433.00,322.00 433.00,322.00 433.00,322.00 431.50,323.25 431.50,323.25 431.50,323.25 430.25,340.00 430.25,340.00 430.25,340.00 425.75,338.00 425.75,338.00 425.75,338.00 421.25,326.00 421.25,326.00 421.25,326.00 418.75,315.00 418.50,315.00 418.25,315.00 414.50,295.25 414.50,295.25 414.50,295.25 414.25,274.50 414.25,274.50 414.25,274.50 414.00,251.50 414.00,251.50 414.00,251.50 414.25,237.25 414.25,237.25 414.25,237.25 414.75,232.00 414.75,229.25"
  ],
  Obliques: [
    "M 134.28,178.67 C 135.80,178.08 137.44,177.63 138.74,176.72 142.62,174.02 145.10,170.17 146.78,165.84 147.58,163.80 147.29,161.70 146.02,159.83 143.83,156.62 141.13,153.89 138.15,151.43 137.82,151.16 137.39,151.02 136.74,150.68 136.87,151.36 136.92,151.76 137.02,152.15 138.19,156.68 138.78,161.29 138.44,165.97 138.11,170.47 136.77,174.56 133.37,177.76 133.19,177.94 133.06,178.17 132.66,178.69 133.43,178.69 133.91,178.81 134.28,178.67",
    "M 96.36,177.87 C 93.31,175.14 91.86,171.59 91.33,167.64 90.63,162.39 91.23,157.23 92.57,152.14 92.68,151.73 92.71,151.30 92.78,150.88 92.69,150.83 92.60,150.78 92.51,150.72 92.06,151.03 91.54,151.26 91.17,151.65 88.72,154.19 86.19,156.67 83.92,159.37 82.10,161.53 81.92,164.15 83.14,166.68 84.09,168.66 85.19,170.60 86.47,172.39 88.38,175.05 90.74,177.28 93.94,178.36 94.81,178.66 95.73,179.06 96.79,178.44 96.58,178.17 96.50,177.99 96.36,177.87",
    "M 133.30,127.21 C 134.46,133.05 135.57,138.89 136.92,144.67 137.30,146.28 138.27,147.83 139.28,149.17 140.60,150.93 142.19,152.50 143.76,154.05 146.20,156.46 148.04,159.20 148.93,162.54 149.03,162.88 149.17,163.22 149.39,163.82 150.71,162.19 151.16,160.53 151.28,158.82 151.28,158.82 152.05,150.83 152.05,150.83 152.19,149.95 152.36,149.07 152.47,148.18 153.20,142.15 153.30,136.10 152.92,130.04 152.72,126.77 152.45,123.50 152.14,120.24 152.01,118.81 151.55,118.53 150.26,119.02 150.26,119.02 135.99,124.40 135.99,124.40 135.99,124.40 135.99,124.41 135.99,124.41 135.78,124.42 135.56,124.44 135.32,124.48 133.82,124.70 133.01,125.72 133.30,127.21",
    "M 79.63,119.11 C 79.59,119.09 79.56,119.08 79.52,119.06 79.52,119.06 79.39,119.02 79.39,119.02 79.39,119.02 79.39,119.02 79.39,119.02 77.87,118.42 77.56,119.01 77.32,121.30 76.60,128.01 76.33,134.74 76.69,141.49 76.83,144.18 77.31,147.83 77.60,150.78 77.60,150.78 77.60,150.83 77.60,150.83 77.60,150.83 78.30,158.17 78.30,158.17 78.30,158.23 78.30,158.29 78.30,158.36 78.33,160.24 78.75,162.03 80.08,163.65 80.28,163.40 80.39,163.33 80.42,163.23 80.55,162.88 80.67,162.51 80.78,162.15 81.49,159.74 82.57,157.54 84.32,155.70 85.82,154.13 87.32,152.56 88.81,150.98 91.12,148.51 92.82,145.72 93.31,142.29 93.42,141.50 93.60,140.72 93.76,139.94 94.61,135.79 95.50,131.66 96.28,127.50 96.64,125.60 95.80,124.63 93.88,124.42 93.80,124.42 93.73,124.42 93.65,124.41 93.65,124.41 93.66,124.40 93.66,124.40 93.66,124.40 79.63,119.11 79.63,119.11",
    "M 131.50,125.25 C 131.50,125.25 135.75,145.25 135.75,145.25 135.75,145.25 136.75,154.00 136.75,154.00 136.75,154.00 137.00,164.75 137.00,164.75 137.00,164.75 136.25,171.75 136.25,171.75 136.25,171.75 132.75,176.75 132.75,176.75 132.75,176.75 134.75,180.25 134.75,180.25 134.75,180.25 133.50,192.00 133.50,192.00 133.50,192.00 130.75,202.50 130.75,202.50 130.75,202.50 124.75,217.25 124.75,217.25 124.75,217.25 123.25,220.50 123.25,220.50 123.25,220.50 132.00,217.25 132.00,217.25 132.00,217.25 144.75,204.00 144.75,204.00 144.75,204.00 151.25,192.75 151.25,192.75 151.25,192.75 152.50,184.25 152.50,184.25 152.50,184.25 152.00,171.75 152.00,171.75 152.00,171.75 151.25,167.00 151.25,167.00 151.25,167.00 154.75,158.50 154.75,158.50 154.75,158.50 155.25,133.75 155.25,133.75 155.25,133.75 154.50,116.50 154.50,116.25 154.50,116.00 152.00,117.00 152.00,117.00 152.00,117.00 145.75,120.25 145.75,120.25 145.75,120.25 138.25,123.50 138.25,123.50 138.25,123.50 131.50,125.00 131.50,125.00",
    "M 75.00,115.75 C 75.00,115.75 74.00,138.50 74.00,138.50 74.00,138.50 75.50,151.00 75.50,151.00 75.50,151.00 75.75,163.25 75.75,163.25 75.75,163.25 78.75,166.50 78.75,166.50 78.75,166.50 76.00,179.50 76.00,179.50 76.00,179.50 76.00,187.00 76.00,187.00 76.00,187.00 77.75,192.00 77.75,192.00 77.75,192.00 81.50,197.50 81.50,197.50 81.50,197.50 87.25,205.50 87.25,205.50 87.25,205.50 94.00,213.50 94.00,213.50 94.00,213.50 102.25,219.25 102.25,219.25 102.25,219.25 106.00,220.75 106.00,220.75 106.00,220.75 101.25,207.00 101.25,207.00 101.25,207.00 96.75,194.50 96.75,194.50 96.75,194.50 95.00,180.00 94.75,180.00 94.50,180.00 96.25,177.25 96.25,177.25 96.25,177.25 93.50,170.50 93.50,170.50 93.50,170.50 93.25,155.00 93.25,155.00 93.25,155.00 94.00,142.75 94.00,142.75 94.00,142.75 96.75,127.75 96.75,127.75 96.75,127.75 98.50,125.00 98.50,125.00 98.50,125.00 80.50,119.00 80.50,119.00 80.50,119.00 75.25,115.50 75.25,115.50",
  ],
  Quads: [
    "M 77.00,190.50 C 77.00,190.50 83.75,201.75 83.75,201.75 83.75,201.75 88.25,208.75 88.25,208.75 88.25,208.75 95.25,214.50 95.25,214.50 95.25,214.50 106.75,222.50 106.75,222.50 106.75,222.50 112.25,224.50 112.25,224.50 112.25,224.50 112.75,239.50 112.75,239.50 112.75,239.50 107.75,269.00 107.75,269.00 107.75,269.00 104.00,280.75 104.00,280.75 104.00,280.75 105.75,298.25 105.75,298.25 105.75,298.25 104.50,314.50 104.50,314.50 104.50,314.50 99.25,331.25 99.25,331.25 99.25,331.25 95.50,336.75 95.50,336.75 95.50,336.75 94.25,316.00 94.25,316.00 94.25,316.00 90.75,307.75 90.75,307.75 90.75,307.75 85.50,315.75 85.50,315.75 85.50,315.75 78.00,326.25 78.00,326.25 78.00,326.25 75.25,328.75 75.25,328.75 75.25,328.75 74.00,303.00 74.00,303.00 74.00,303.00 64.75,276.75 64.75,276.75 64.75,276.75 64.25,264.25 64.25,264.25 64.25,264.25 64.25,248.00 64.25,248.00 64.25,248.00 65.75,221.25 65.75,221.25 65.75,221.25 69.50,210.75 69.50,210.75 69.50,210.75 74.00,198.50 74.00,198.50 74.00,198.50 77.00,190.75 77.00,190.75",
    "M 118.25,225.00 C 118.25,225.00 128.75,219.00 128.75,219.00 128.75,219.00 137.25,212.25 137.25,212.25 137.25,212.25 145.25,202.00 145.25,202.00 145.25,202.00 152.75,190.75 152.75,190.75 152.75,190.75 157.25,198.50 157.25,198.50 157.25,198.50 162.00,212.25 162.00,212.25 162.00,212.25 165.50,229.00 165.50,229.00 165.50,229.00 166.50,244.25 166.50,244.25 166.50,244.25 167.50,256.25 167.50,256.25 167.50,256.25 164.25,273.00 164.25,273.00 164.25,273.00 160.50,288.00 160.50,288.00 160.50,288.00 157.00,298.75 157.00,298.75 157.00,298.75 155.50,303.75 155.50,303.75 155.50,303.75 155.50,316.25 155.50,316.25 155.50,316.25 155.00,331.00 155.00,331.00 155.00,331.00 147.75,319.75 147.75,319.75 147.75,319.75 139.50,307.50 139.50,307.50 139.50,307.50 138.00,308.75 138.00,308.75 138.00,308.75 136.75,316.00 136.75,316.00",
  ],
  Shoulders: [
    "M 49.75,117.25 C 49.75,117.25 57.75,114.25 57.75,114.25 57.75,114.25 68.00,110.50 68.00,110.50 68.00,110.50 71.25,111.50 71.25,111.50 71.25,111.50 73.00,113.00 73.00,113.00 73.00,113.00 74.50,116.50 74.50,116.50 74.50,116.50 74.50,120.25 74.50,120.25 74.50,120.25 74.25,129.50 74.25,129.50 74.25,129.50 74.00,110.50 74.00,110.50 74.00,110.50 64.75,108.50 64.75,108.50 64.75,108.50 56.50,110.50 56.50,110.50 56.50,110.50 49.75,117.25 49.75,117.25",
    "M 166.82,151.36 C 166.82,151.36 158.25,114.97 158.25,114.97 158.25,114.97 165.50,111.75 165.50,111.75 165.50,111.75 174.50,115.00 174.50,115.00 174.50,115.00 177.61,114.52 177.61,114.52 177.61,114.52 182.68,125.43 182.68,125.43 182.68,125.43 158.57,137.01 158.57,137.01 158.57,137.01 166.82,151.36 166.82,151.36",
  ],
  Traps: [
    "M 74.00,108.50 C 74.00,108.50 84.50,87.50 84.50,87.50 84.50,87.50 95.50,83.50 95.50,83.50 95.50,83.50 113.00,86.75 113.00,86.75 113.00,86.75 126.75,86.00 126.75,86.00 126.75,86.00 138.00,83.50 138.00,83.50 138.00,83.50 144.62,89.25 144.62,89.25 144.62,89.25 154.00,110.50 154.00,110.50 154.00,110.50 113.00,112.72 113.00,112.72 113.00,112.72 74.00,108.50 74.00,108.50",
  ],
  Triceps: [
    "M 396.09,118.55 C 396.09,118.55 389.33,108.45 389.33,108.45 389.33,108.45 384.32,94.04 384.32,94.04 384.32,94.04 380.09,95.76 380.09,95.76 380.09,95.76 372.19,104.64 372.19,104.64 372.19,104.64 370.05,116.31 370.05,116.31 370.05,116.31 370.02,126.70 370.02,126.70 370.02,126.70 375.97,142.87 375.97,142.87 375.97,142.87 384.60,148.72 384.60,148.72 384.60,148.72 391.14,148.39 391.14,148.39 391.14,148.39 397.77,143.96 397.77,143.96 397.77,143.96 400.84,140.67 400.84,140.67 400.84,140.67 396.09,118.55 396.09,118.55",
    "M 452.92,116.24 C 452.92,116.24 451.53,107.77 451.53,107.77 451.53,107.77 441.63,94.86 441.63,94.86 441.63,94.86 437.60,99.79 437.60,99.79 437.60,99.79 429.54,114.24 429.54,114.24 429.54,114.24 426.99,118.41 426.99,118.41 426.99,118.41 421.24,127.18 421.24,127.18 421.24,127.18 421.78,140.59 421.78,140.59 421.78,140.59 430.44,147.38 430.44,147.38 430.44,147.38 437.71,149.46 437.71,149.46 437.71,149.46 445.32,145.70 445.32,145.70 445.32,145.70 449.73,138.50 449.73,138.50 449.73,138.50 452.39,133.25 452.39,133.25 452.39,133.25 452.92,116.24 452.92,116.24",
  ],
};

const WorkoutGenerator: React.FC = () => {
  const navigate = useNavigate();
  const user = useStore(state => state.user);
  
  const [step, setStep] = useState(1);
  const [loading, setLoading] = useState(false);
  const [generatedPlan, setGeneratedPlan] = useState<GeneratedWorkoutPlan | null>(null);
  
  const [preferences, setPreferences] = useState({
    focus: 'Abs' as MuscleGroup,
    level: 'Beginner',
    duration: '30 min',
    equipment: 'None'
  });

  const handleGenerate = async () => {
    if (!user?.apiKey) {
      alert("Please add your API Key in Profile settings first.");
      navigate('/profile');
      return;
    }

    setLoading(true);
    setStep(3); // Loading View
    try {
      const plan = await generateWorkoutPlan(user.apiKey, preferences);
      setGeneratedPlan(plan);
      setStep(4); // Success View
    } catch (e: any) {
      alert(e.message || "Failed to generate workout");
      setStep(2); // Go back to settings
    } finally {
      setLoading(false);
    }
  };

  const muscleGroups: MuscleGroup[] = Object.keys(MUSCLE_DATA) as MuscleGroup[];

  return (
    <div className="pb-24 pt-8 px-6 min-h-screen bg-[#0A0A0F]">
       {/* Header */}
       <div className="flex items-center justify-between mb-6">
          <button onClick={() => navigate(-1)} className="p-2 bg-white/5 rounded-full text-white hover:bg-white/10">
             <ArrowLeft size={20} />
          </button>
          <h1 className="text-xl font-bold text-white flex items-center gap-2">
            <Sparkles size={18} className="text-[#F6822B]" /> AI Generator
          </h1>
          <div className="w-9" /> {/* Spacer */}
       </div>

       <AnimatePresence mode="wait">
          {/* Step 1: Muscle Selection */}
          {step === 1 && (
            <motion.div
              key="step1"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              className="space-y-6"
            >
               <div className="text-center">
                  <h2 className="text-2xl font-bold text-white mb-2">Target Muscle</h2>
                  <p className="text-white/50 text-sm">Select the primary focus area</p>
               </div>

               {/* Interactive Muscle Map Visualization Placeholder */}
               <div className="h-[300px] w-full bg-white/5 rounded-3xl relative overflow-hidden flex items-center justify-center border border-white/10">
                  <svg viewBox="0 0 512 512" className="h-full w-full p-4 opacity-80">
                      <g transform="scale(0.9) translate(25, 25)">
                        {/* Render all muscles faintly */}
                        {muscleGroups.map(group => (
                          MUSCLE_DATA[group].map((d, i) => (
                             <path key={`${group}-${i}`} d={d} fill="#333" stroke="none" />
                          ))
                        ))}
                        {/* Highlight selected muscle */}
                        {MUSCLE_DATA[preferences.focus].map((d, i) => (
                           <path 
                             key={`selected-${i}`} 
                             d={d} 
                             fill="#F6822B" 
                             className="drop-shadow-[0_0_10px_rgba(246,130,43,0.5)] transition-all duration-300"
                           />
                        ))}
                      </g>
                  </svg>
                  
                  {/* Overlay Controls */}
                  <div className="absolute bottom-4 left-4 right-4 flex overflow-x-auto gap-2 no-scrollbar pb-2">
                      {muscleGroups.map(group => (
                         <button
                           key={group}
                           onClick={() => setPreferences({...preferences, focus: group})}
                           className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-colors ${preferences.focus === group ? 'bg-[#F6822B] text-white' : 'bg-white/10 text-white/50 hover:bg-white/20'}`}
                         >
                            {group}
                         </button>
                      ))}
                  </div>
               </div>

               <PrimaryButton onClick={() => setStep(2)} fullWidth>
                  Continue
               </PrimaryButton>
            </motion.div>
          )}

          {/* Step 2: Settings */}
          {step === 2 && (
             <motion.div
               key="step2"
               initial={{ opacity: 0, x: 20 }}
               animate={{ opacity: 1, x: 0 }}
               exit={{ opacity: 0, x: -20 }}
               className="space-y-8"
             >
                <div className="text-center">
                   <h2 className="text-2xl font-bold text-white mb-2">Fine Tune</h2>
                   <p className="text-white/50 text-sm">Customize your session</p>
                </div>

                <div className="space-y-6">
                   {/* Level */}
                   <div>
                      <label className="text-xs text-white/50 uppercase font-bold mb-3 block ml-1">Difficulty</label>
                      <div className="grid grid-cols-3 gap-3">
                         {['Beginner', 'Intermediate', 'Advanced'].map(l => (
                            <button
                              key={l}
                              onClick={() => setPreferences({...preferences, level: l})}
                              className={`py-3 rounded-xl text-sm font-bold border transition-all ${preferences.level === l ? 'bg-white text-black border-white' : 'bg-transparent text-white/50 border-white/10 hover:bg-white/5'}`}
                            >
                               {l}
                            </button>
                         ))}
                      </div>
                   </div>

                   {/* Duration */}
                   <div>
                      <label className="text-xs text-white/50 uppercase font-bold mb-3 block ml-1">Duration</label>
                      <div className="grid grid-cols-3 gap-3">
                         {['15 min', '30 min', '45 min'].map(d => (
                            <button
                              key={d}
                              onClick={() => setPreferences({...preferences, duration: d})}
                              className={`py-3 rounded-xl text-sm font-bold border transition-all ${preferences.duration === d ? 'bg-white text-black border-white' : 'bg-transparent text-white/50 border-white/10 hover:bg-white/5'}`}
                            >
                               {d}
                            </button>
                         ))}
                      </div>
                   </div>

                   {/* Equipment */}
                   <div>
                      <label className="text-xs text-white/50 uppercase font-bold mb-3 block ml-1">Equipment</label>
                      <div className="grid grid-cols-2 gap-3">
                         {['None', 'Dumbbells', 'Resistance Bands', 'Full Gym'].map(e => (
                            <button
                              key={e}
                              onClick={() => setPreferences({...preferences, equipment: e})}
                              className={`py-3 rounded-xl text-sm font-bold border transition-all ${preferences.equipment === e ? 'bg-white text-black border-white' : 'bg-transparent text-white/50 border-white/10 hover:bg-white/5'}`}
                            >
                               {e}
                            </button>
                         ))}
                      </div>
                   </div>
                </div>

                <PrimaryButton onClick={handleGenerate} fullWidth>
                   <span className="flex items-center justify-center gap-2">
                     <Zap size={18} /> Generate Workout
                   </span>
                </PrimaryButton>
             </motion.div>
          )}

          {/* Step 3: Loading */}
          {step === 3 && (
             <motion.div
               key="step3"
               initial={{ opacity: 0 }}
               animate={{ opacity: 1 }}
               exit={{ opacity: 0 }}
               className="flex flex-col items-center justify-center h-[60vh] text-center"
             >
                <div className="relative mb-8">
                   <div className="absolute inset-0 bg-[#F6822B] blur-3xl opacity-20 animate-pulse" />
                   <div className="relative bg-[#F6822B]/10 p-6 rounded-full border border-[#F6822B]/20">
                      <Loader2 size={48} className="text-[#F6822B] animate-spin" />
                   </div>
                </div>
                <h2 className="text-2xl font-bold text-white mb-2">Consulting AI Coach...</h2>
                <p className="text-white/50 text-sm max-w-[200px]">Designing a {preferences.level} {preferences.focus} routine just for you.</p>
             </motion.div>
          )}

          {/* Step 4: Result */}
          {step === 4 && generatedPlan && (
             <motion.div
               key="step4"
               initial={{ opacity: 0, y: 20 }}
               animate={{ opacity: 1, y: 0 }}
               className="space-y-6"
             >
                <GlassCard className="border-[#F6822B]/30 bg-gradient-to-br from-[#F6822B]/10 to-transparent">
                   <div className="flex justify-between items-start mb-4">
                      <div>
                         <h2 className="text-2xl font-bold text-white leading-tight mb-1">{generatedPlan.title}</h2>
                         <div className="flex gap-2 text-xs">
                            <span className="bg-white/10 px-2 py-1 rounded text-white/70">{generatedPlan.difficulty}</span>
                            <span className="bg-white/10 px-2 py-1 rounded text-white/70">{generatedPlan.duration}</span>
                         </div>
                      </div>
                      <div className="p-3 bg-[#F6822B] rounded-xl text-white shadow-lg shadow-orange-500/20">
                         <Trophy size={24} />
                      </div>
                   </div>
                </GlassCard>

                <div className="space-y-4">
                   <h3 className="text-sm font-bold text-white/50 uppercase tracking-wider ml-1">Exercises</h3>
                   {generatedPlan.exercises.map((ex, idx) => (
                      <GlassCard key={idx} className="flex gap-4">
                         <div className="flex flex-col items-center justify-center w-12 bg-white/5 rounded-xl border border-white/5">
                            <span className="text-lg font-bold text-[#F6822B]">{idx + 1}</span>
                         </div>
                         <div className="flex-1">
                            <h4 className="font-bold text-white text-lg">{ex.name}</h4>
                            <div className="flex gap-3 my-2 text-sm text-white/60">
                               <span className="flex items-center gap-1"><Activity size={12}/> {ex.sets} sets</span>
                               <span className="flex items-center gap-1"><Dumbbell size={12}/> {ex.reps}</span>
                               <span className="flex items-center gap-1"><Clock size={12}/> {ex.rest}</span>
                            </div>
                            <div className="text-xs text-white/40 bg-white/5 p-2 rounded-lg italic">
                               "{ex.notes}"
                            </div>
                         </div>
                      </GlassCard>
                   ))}
                </div>

                <div className="flex gap-3 pt-4">
                   <button 
                     onClick={() => setStep(1)}
                     className="flex-1 py-4 rounded-2xl bg-white/5 text-white font-bold hover:bg-white/10 transition-colors"
                   >
                     Regenerate
                   </button>
                   <PrimaryButton onClick={() => navigate('/dashboard')} fullWidth>
                      Save & Start
                   </PrimaryButton>
                </div>
             </motion.div>
          )}
       </AnimatePresence>
    </div>
  );
};

export default WorkoutGenerator;
